<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Genesys Script Test</title>
    <link rel="stylesheet" href="/assets/genesys/plugins/widgets.min.css" />
    <link rel="stylesheet" href="/assets/genesys/styles/bcbst-custom.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      }
      #log {
        background-color: #333;
        color: white;
        padding: 15px;
        border-radius: 5px;
        font-family: monospace;
        height: 300px;
        overflow-y: auto;
        margin: 20px 0;
      }
      button {
        padding: 10px 15px;
        background-color: #0ea5e9;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Genesys Script Direct Test</h1>
    <p>
      This page directly loads the Genesys chat script without going through
      Next.js.
    </p>

    <div>
      <button id="loadBtn">Load Script</button>
      <button id="checkBtn">Check Window Objects</button>
    </div>

    <div id="log"></div>

    <div id="genesys-chat-container"></div>

    <script>
      // Simple logger
      function log(message) {
        console.log(`[TEST] ${message}`);
        const logElement = document.getElementById('log');
        const entry = document.createElement('div');
        entry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
        logElement.appendChild(entry);
        logElement.scrollTop = logElement.scrollHeight;
      }

      // Set up window.chatSettings
      function setupChatSettings() {
        window.chatSettings = {
          clickToChatToken: 'test-token',
          clickToChatEndpoint: 'https://example.com/api',
          routingchatbotEligible: 'true',
          isChatEligibleMember: 'true',
          isDemoMember: false,
          isAmplifyMem: false,
          isCobrowseActive: false,
        };
        log('Set up window.chatSettings');
      }

      // Load the script
      function loadScript() {
        log('Starting script load');

        // Set up chat settings
        setupChatSettings();

        // Add timestamp for cache busting
        const timestamp = new Date().getTime();

        // Create script element
        const script = document.createElement('script');
        script.src = `/assets/genesys/click_to_chat.js?t=${timestamp}`;

        script.onload = function () {
          log('✅ Script loaded successfully');

          // Try to initialize the chat button
          setTimeout(function () {
            if (window._forceChatButtonCreate) {
              log('Calling _forceChatButtonCreate()');
              window._forceChatButtonCreate();
            } else {
              log('_forceChatButtonCreate not found on window');
            }

            log('Dispatching genesys:create-button event');
            document.dispatchEvent(new CustomEvent('genesys:create-button'));
          }, 1000);
        };

        script.onerror = function (error) {
          log(`❌ Script failed to load: ${error}`);
        };

        document.body.appendChild(script);
        log('Added script element to DOM');
      }

      // Check window objects
      function checkWindowObjects() {
        const details = {
          chatSettings: !!window.chatSettings,
          chatSettingsKeys: window.chatSettings
            ? Object.keys(window.chatSettings)
            : [],
          _forceChatButtonCreate: !!window._forceChatButtonCreate,
          CXBus: !!window.CXBus,
        };
        log(`Window objects: ${JSON.stringify(details)}`);
      }

      // Initialize on page load
      document.addEventListener('DOMContentLoaded', function () {
        log('Page loaded');

        // Set up button listeners
        document
          .getElementById('loadBtn')
          .addEventListener('click', loadScript);
        document
          .getElementById('checkBtn')
          .addEventListener('click', checkWindowObjects);
      });
    </script>
  </body>
</html>
